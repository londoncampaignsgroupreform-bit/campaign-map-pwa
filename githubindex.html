<script>
const API = "https://script.google.com/macros/s/DEPLOYMENT_ID/exec";

async function init() {
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  if (!token) {
    window.location.href = "login.html";
    return;
  }

  const response = await fetch(`${API}?action=validate&token=${token}`);
  const result = await response.json();

  if (!result.success) {
    window.location.href = "login.html";
    return;
  }

  // âœ… Now you have user, role, sheets
  console.log("Logged in as:", result.user);
  console.log("Role:", result.role);

  loadMap(result);
}

init();
</script>
